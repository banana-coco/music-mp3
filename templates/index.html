<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3 & URL ツール</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .file-list, .url-list { list-style: none; padding: 0; }
        .item { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 10px; display: flex; flex-direction: column; gap: 10px; }
        .info { display: flex; justify-content: space-between; align-items: center; }
        .name { font-weight: bold; font-size: 1.1em; }
        .audio-player { width: 100%; }
        .actions { display: flex; gap: 10px; align-items: center; }
        .btn { padding: 8px 15px; border-radius: 4px; text-decoration: none; border: none; cursor: pointer; font-size: 0.9em; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .flash { padding: 10px; background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; border-radius: 4px; margin-bottom: 20px; }
        .short-url { color: #007bff; font-weight: bold; text-decoration: none; }
    </style>
</head>
<body>
    <h1>MP3 & URL ツール</h1>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <div class="flash">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="section">
        <h3>URL短縮 (UL)</h3>
        <form action="{{ url_for('shorten_url') }}" method="post" style="display: flex; gap: 10px;">
            <input type="text" name="url" placeholder="短縮したいURLを入力 (例: google.com)" required style="flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
            <button type="submit" class="btn btn-success">短縮する</button>
        </form>
    </div>

    <div class="section">
        <h3>MP3アップロード</h3>
        <form action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
            <input type="file" name="file" accept=".mp3" required>
            <button type="submit" class="btn btn-primary">アップロード</button>
        </form>
    </div>

    <h2>短縮済みURL一覧</h2>
    <div class="url-list">
        {% for url in urls %}
        <div class="item">
            <div class="info">
                <a href="{{ url_for('redirect_to_url', short_code=url.short_code, _external=True) }}" target="_blank" class="short-url">
                    {{ url_for('redirect_to_url', short_code=url.short_code, _external=True) }}
                </a>
                <form action="{{ url_for('delete_url', url_id=url.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('本当に削除しますか？')">削除</button>
                </form>
            </div>
            <div style="font-size: 0.8em; color: #666; word-break: break-all;">
                元のURL: {{ url.original_url }}
            </div>
        </div>
        {% else %}
        <p>短縮されたURLはありません。</p>
        {% endfor %}
    </div>

    <h2>投稿されたMP3ファイル</h2>
    <div class="file-list">
        {% for file in files %}
        <div class="item">
            <div class="info">
                <span class="name">{{ file.display_name }}</span>
                <span style="color: #666; font-size: 0.8em;">{{ file.upload_date.strftime('%Y-%m-%d %H:%M') }}</span>
            </div>
            <audio controls class="audio-player">
                <source src="{{ url_for('play_file', file_id=file.id) }}" type="audio/mpeg">
            </audio>
            <div class="actions">
                <a href="{{ url_for('download_file', file_id=file.id) }}" class="btn btn-primary">ダウンロード</a>
                <form action="{{ url_for('delete_file', file_id=file.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('本当に削除しますか？')">削除</button>
                </form>
            </div>
        </div>
        {% else %}
        <p>MP3ファイルはまだありません。</p>
        {% endfor %}
    </div>
</body>
</html>
